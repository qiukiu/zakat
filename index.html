<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Form Zakat KMIB 1446H / 2025</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }
    /* Header styles */
    .header-container {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 20px;
      border-bottom: 2px solid #ccc;
      padding-bottom: 10px;
    }
    .header-container h1 {
      margin: 0;
      flex-grow: 1;
      text-align: center;
      font-size: 2em;
      color: #333;
    }
    .logo {
      max-height: 80px;
      width: auto;
    }
    h2, h3 {
      color: #333;
    }
    form {
      max-width: 800px;
      margin: auto;
    }
    label {
      display: block;
      margin-top: 10px;
    }
    input[type="text"],
    input[type="email"],
    input[type="number"],
    input[type="file"] {
      width: 100%;
      padding: 8px;
      margin-top: 4px;
      box-sizing: border-box;
    }
    .toggle-buttons {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
      margin-top: 10px;
    }
    .toggle-button,
    .payment-button {
      padding: 25px;
      font-size: 1.2em;
      border: 1px solid #aaa;
      background-color: #f5f5f5;
      cursor: pointer;
      transition: background-color 0.3s;
    }
    .toggle-button.active,
    .payment-button.active {
      background-color: #2196F3;
      color: white;
    }
    .donation-section {
      border: 1px solid #ddd;
      padding: 10px;
      margin-top: 15px;
    }
    #summarySection {
      border: 2px solid #4CAF50;
      padding: 10px;
      margin-top: 20px;
      text-align: center;
      font-weight: bold;
    }
    #submitSection {
      text-align: center;
      margin-top: 20px;
    }
    button[type="submit"] {
      padding: 10px 20px;
      background-color: #2196F3;
      color: white;
      border: none;
      cursor: pointer;
      font-size: 1.2em;
    }
    .collage-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      margin-top: 10px;
    }
    .collage-grid img {
      width: 100%;
      height: 800px;
      object-fit: cover;
      border: 1px solid #ccc;
      padding: 3px;
    }
    #randomGallery h3 {
      text-align: center;
    }
    .form-group {
      margin-bottom: 15px;
    }
    .input-group {
      display: flex;
    }
    .input-group .form-control {
      flex: 1;
      padding: 8px;
      font-size: 1.1em;
    }
    .input-group .btn {
      padding: 8px 12px;
      font-size: 1.1em;
      cursor: pointer;
      border: 1px solid #aaa;
      background-color: #f5f5f5;
      transition: background-color 0.3s;
    }
    .input-group .btn:hover {
      background-color: #ddd;
    }

    input[type="checkbox"] {
      vertical-align: middle;
      margin-right: 8px;
    }

    label {
      display: inline-block;
      vertical-align: middle;
      margin-bottom: 7px;
    }
    /* Style for the form container */
    .form-container {
      display: flex;
      align-items: center; /* Align items vertically centered */
      justify-content: flex-start; /* Align items to the left */
    }

    /* Style for the input field */
    .form-control {
      padding: 10px;
      font-size: 1.2em;
      margin-right: 10px; /* Space between input and button */
    }

    /* Style for the link that will act as a button */
    .button-link {
      display: inline-block;
      background-color: #2196F3;
      color: white;
      padding: 0px 8px;
      text-align: center;
      border: none;
      border-radius: 5px;
      text-decoration: none; /* Remove underline from link */
      font-size: 1.2em;
      cursor: pointer;
      transition: background-color 0.3s;
    }

    .button-link:hover {
      background-color: #1976D2;
    }
  </style>
</head>
<body>
  <!-- Header with two logos and centered title -->
  <div class="header-container">
    <img src="Logokmib.png" alt="KMIB" class="logo">
    <h1>Form Zakat KMIB 1446H / 2025</h1>
    <img src="Logoppa.png" alt="ppa" class="logo">
  </div>
  
  <form id="donationForm" enctype="multipart/form-data">
    <!-- Personal Information -->
    <section id="personalInfo">
      <label for="email">Email:</label>
      <input type="email" id="email" name="email" required>
      
      <label for="asalKota">Asal Kota:</label>
      <input type="text" id="asalKota" name="asalKota" required>
    </section>
    
    <!-- Donation Type Selection -->
    <section id="donationTypeSelection">
      <h2>Pilih Jenis Donasi</h2>
      <p>Silahkan pilih satu atau lebih</p>
      <div class="toggle-buttons">
        <button type="button" class="toggle-button" data-type="fitrah">Zakat Fitrah</button>
        <button type="button" class="toggle-button" data-type="maal">Zakat Maal</button>
        <button type="button" class="toggle-button" data-type="fidyah">Fidyah</button>
        <button type="button" class="toggle-button" data-type="infak">Infak</button>
      </div>
    </section>
    
    <!-- Zakat Fitrah Section -->
    <section id="section-fitrah" class="donation-section" style="display:none;">
      <h3>Zakat Fitrah</h3>
      <p>Dinamakan fitrah karena fitrah wajib setelah orang-orang berbuka dari puasa Ramadhan. Fitrah juga bisa bermakna kejadian, zakat fitrah juga bisa disebut dengan zakat badan seperti disebutkan di dalam hadis.</p>
      <p>زكاة الفطرطهرة للصائم من الرفث وطعمة للفقراء والمساكين<a><span>[1]</span></a></p>
      <p>Artinya : Zakat fitrah mensucikan bagi orang yang berpuasa dari kotoran/dosa, dan makanan bagi orang fakir dan miskin.</p>
      <p>Besaran zakat fitrah adalah 2.75 kg bahan pokok, atau 3 kg untuk berjaga-jaga.</p>
      <label for="jumlahJiwa">Jumlah Jiwa:</label>
      <input type="number" id="jumlahJiwa" name="jumlahJiwa" min="1">
      <p>Zakat Fitrah: 10€ per jiwa</p>
      <div id="fitrahNames"></div>
      <img src="Niat Zakat Fitrah.png" alt="Niat Zakat Fitrah">
      <p>Nawaytu An Ukhrija Zakaata Al-fitri Anni (Wa An Jami’i Ma Yalzimuniy Nafaqatuhum Syar’an) Fardhan Lillahi Ta’ala</p>
      <input type="checkbox" id="niat" name="niat">
      <label for="niat">Saya telah membaca niat.</label>
    </section>
    
    <!-- Zakat Maal Section -->
    <section id="section-maal" class="donation-section" style="display:none;">
      <h3>Zakat Maal</h3>
      <p>Maal berasal dari kata bahasa Arab artinya harta atau kekayaan. Menurut Islam, harta merupakan sesuatu yang boleh dimiliki dan digunakan sesuai kebutuhan. Zakat maal dikenakan atas berbagai jenis harta dan perhitungannya dilakukan oleh muzakki sendiri.</p>
      <a href="https://www.hasene.org/de/zakat-rechner/">https://www.hasene.org/de/zakat-rechner/</a>
      <div>
      <label for="namaMaal">Nama:</label>
      <input type="text" id="namaMaal" name="namaMaal">
      <label for="jumlahMaal">Jumlah Zakat Maal:</label>
      <input type="number" id="jumlahMaal" name="jumlahMaal" min="0">
      </div>
    </section>
    
    <!-- Fidyah Section -->
    <section id="section-fidyah" class="donation-section" style="display:none;">
      <h3>Fidyah</h3>
      <p>الفدية هي مدواحد لكل يوم من غالب قوت البلد...</p>
      <p>Dikeluarkan 1 mud setiap harinya berupa bahan makanan pokok. Atau sama dengan 0,68 Kg (2.75 kg/4 mud).</p>
      <label for="namaFidyah">Nama:</label>
      <input type="text" id="namaFidyah" name="namaFidyah">
      <label for="jumlahHari">Jumlah Hari:</label>
      <input type="number" id="jumlahHari" name="jumlahHari" min="0">
      <p>Fidyah: 3€ per hari</p>
    </section>
    
    <!-- Infak Section -->
    <section id="section-infak" class="donation-section" style="display:none;">
      <h3>Infak</h3>
      <label for="namaInfak">Nama:</label>
      <input type="text" id="namaInfak" name="namaInfak">
      <label for="jumlahInfak">Jumlah Infak:</label>
      <input type="number" id="jumlahInfak" name="jumlahInfak" min="0">
    </section>
    
    <!-- Summary Section -->
    <section id="summarySection">
      <h2>Total yang dibayarkan</h2>
      <p id="summaryText">Total: 0€</p>
    </section>
    
    <!-- Payment Options Section -->
    <section id="paymentOptions">
      <h2>Pilih Metode Pembayaran</h2>
      <div class="toggle-buttons">
        <button type="button" class="payment-button" data-method="IBAN transfer">IBAN Transfer</button>
        <button type="button" class="payment-button" data-method="Paypal friends and familly">Paypal Friends and Familly</button>
        <button type="button" class="payment-button" data-method="Cash">Cash</button>
      </div>
      <!-- Payment Evidence Section will be inserted here dynamically -->
      <div id="paymentEvidenceSection" style="margin-top:10px;"></div>
    </section>
    
    <!-- Instructions Section -->
    <section id="instructionSection">
      <h2>Instruksi</h2>
      <p>Silakan baca instruksi pembayaran sesuai dengan metode yang dipilih.</p>
      <input type="checkbox" id="acknowledge" name="acknowledge" required>
      <label for="acknowledge">Saya telah memasukkan data dengan benar, membaca dan memahami instruksi di atas.</label>
    </section>
    
    <!-- Submit Section -->
    <section id="submitSection">
      <button type="submit">Submit</button>
    </section>
  </form>
  
  <!-- Random Gallery Section -->
  <section id="randomGallery">
    <h3>Dokumentasi Zakat Fitrah 1445H / 2024</h3>
    <div id="randomImages" class="collage-grid"></div>
  </section>
  
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Toggle donation type buttons
      const toggleButtons = document.querySelectorAll('.toggle-button');
      toggleButtons.forEach(button => {
        button.addEventListener('click', function() {
          const type = this.getAttribute('data-type');
          this.classList.toggle('active');
          const section = document.getElementById('section-' + type);
          section.style.display = this.classList.contains('active') ? 'block' : 'none';
          updateSummary();
        });
      });
      
      // Generate fields for Zakat Fitrah based on "Jumlah Jiwa"
      document.getElementById('jumlahJiwa').addEventListener('change', function() {
        const count = parseInt(this.value) || 0;
        const container = document.getElementById('fitrahNames');
        container.innerHTML = ''; // Clear previous fields
        for (let i = 1; i <= count; i++) {
          const label = document.createElement('label');
          label.textContent = 'Nama Lengkap ' + i + ':';
          label.setAttribute('for', 'namaFitrah_' + i);
          const input = document.createElement('input');
          input.type = 'text';
          input.id = 'namaFitrah_' + i;
          input.name = 'namaFitrah_' + i;
          input.required = true;
          container.appendChild(label);
          container.appendChild(input);
        }
        updateSummary();
      });
      
      // Update summary when inputs change
      const inputs = document.querySelectorAll('#donationForm input');
      inputs.forEach(input => {
        input.addEventListener('input', updateSummary);
      });
      
      // Payment methods event listeners
      const paymentButtons = document.querySelectorAll('.payment-button');
      const paymentEvidenceSection = document.getElementById('paymentEvidenceSection');
      
      paymentButtons.forEach(button => {
        button.addEventListener('click', function() {
          paymentButtons.forEach(btn => btn.classList.remove('active'));
          this.classList.add('active');
          updatePaymentEvidence(this.getAttribute('data-method'));
        });
      });
      
      function updatePaymentEvidence(method) {
        let html = '';
        if (method === 'IBAN transfer') {
          html = `
            <div class="iban-section">
              <div class="form-group">
                <div class="form-container">
                  <div>
                    <p>Nama Bank:</p>
                  </div>
                  <div>
                  <input type="text" id="namaBank" value="Bremische Volksbank" readonly class="form-control">
                  </div>
                </div>
                <div class="form-container">
                  <div>
                  <p>Atas Nama:</p>
                  </div>
                  <div>
                  <input type="text" id="atasNamaBank" value="KMIB.e.V" readonly class="form-control">
                  </div
                </div>
                <div class="input-group">
                  <div>
                  <p>IBAN:</p>
                  </div>
                  <div>
                  <input type="text" id="ibanField" value="DE66291900240049959500" readonly class="form-control">
                  <button type="button" id="copyIbanButton" class="btn btn-secondary">Salin IBAN</button>
                  </div>
                </div>
                <div class="form-container">
                  <div>
                  <p>Zweck:</p>
                  </div>
                  <div>
                  <input type="text" id="zweckb" value="Zakat (nama)" readonly class="form-control">
                  </div>
                </div>
              </div>
              <label for="paymentScreenshot">Upload Screenshot Transaksi (gambar):</label>
              <input type="file" id="paymentScreenshot" name="paymentScreenshot" accept="image/*" required>
            </div>
          `;
        } else if (method === 'Paypal friends and familly') {
          html = `
            <p>pastikan paypal familly and friends terpilih agar tidak terpotong</p>
            <div>
            <div class="form-container">
              <div>
              <p>Email Paypal:</p>
              </div>
              <div>
              <input type="text" id="paypaladdress" value="paypal@kmibremen.de" readonly class="form-control">
              <!-- Link styled as a button -->
              <a href="mailto:paypal@kmibremen.de" class="button-link" target="_blank">Paypal KMIB</a>
              </div>
            </div>
             <div class="form-container">
               <div>
                <p>Zweck:</p>
                </div>
                <div>
                <input type="text" id="zweckpp" value="Zakat (nama)" readonly class="form-control">
                </div>
                </div>
            </div>
            <div><label for="paymentScreenshot">Upload Screenshot Transaksi (gambar):</label>
            <input type="file" id="paymentScreenshot" name="paymentScreenshot" accept="image/*" required></div>
          `;
        } else if (method === 'Cash') {
          html = `
            <input type="checkbox" id="cashConfirmation" name="cashConfirmation" value="ya" required>
            <label for="cashConfirmation">Saya akan hadir secara langsung untuk pembayaran tunai.</label>
          `;
        }
        paymentEvidenceSection.innerHTML = html;
        
        // Attach IBAN copy event listener if IBAN transfer is selected
        if (method === 'IBAN transfer') {
          const copyButton = document.getElementById('copyIbanButton');
          if (copyButton) {
            copyButton.addEventListener('click', function() {
              const text = document.getElementById('ibanField').value;
              if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(text)
                  .then(() => alert("IBAN berhasil disalin!"))
                  .catch(err => {
                    console.error("Clipboard error:", err);
                    fallbackCopyText(text);
                  });
              } else {
                fallbackCopyText(text);
              }
            });
          }
        }
      }
      
      function updateSummary() {
        let total = 0;
        // Zakat Fitrah: jumlah jiwa x 10€
        if (document.querySelector('.toggle-button[data-type="fitrah"]').classList.contains('active')) {
          const jumlahJiwa = parseInt(document.getElementById('jumlahJiwa').value) || 0;
          total += jumlahJiwa * 10;
        }
        // Zakat Maal: jumlah yang diinput
        if (document.querySelector('.toggle-button[data-type="maal"]').classList.contains('active')) {
          const jumlahMaal = parseFloat(document.getElementById('jumlahMaal').value) || 0;
          total += jumlahMaal;
        }
        // Fidyah: jumlah hari x 3€
        if (document.querySelector('.toggle-button[data-type="fidyah"]').classList.contains('active')) {
          const jumlahHari = parseInt(document.getElementById('jumlahHari').value) || 0;
          total += jumlahHari * 3;
        }
        // Infak: jumlah yang diinput
        if (document.querySelector('.toggle-button[data-type="infak"]').classList.contains('active')) {
          const jumlahInfak = parseFloat(document.getElementById('jumlahInfak').value) || 0;
          total += jumlahInfak;
        }
        document.getElementById('summaryText').textContent = 'Total: ' + total + '€';
      }
      
      // Form submission: send data to Google Apps Script
      document.getElementById('donationForm').addEventListener('submit', function(e) {
        e.preventDefault();
        const formData = new FormData(this);
        
        // Determine active payment method
        let paymentMethod = '';
        paymentButtons.forEach(btn => {
          if (btn.classList.contains('active')) {
            paymentMethod = btn.getAttribute('data-method');
          }
        });
        formData.append('paymentMethod', paymentMethod);
        
        fetch('https://script.google.com/macros/s/AKfycbyEdNHBrkZ3nU-l2yiU99spJDbill92Dzew_FSDo8nVWI3HFLmKLXAahB0oeGb8XpXf/exec', {
          method: 'POST',
          body: formData
        })
        .then(response => response.text())
        .then(result => {
          alert('Data terkirim: ' + result);
          // Reset form and hide dynamic sections
          document.getElementById('donationForm').reset();
          document.querySelectorAll('.donation-section').forEach(section => section.style.display = 'none');
          toggleButtons.forEach(btn => btn.classList.remove('active'));
          paymentButtons.forEach(btn => btn.classList.remove('active'));
          paymentEvidenceSection.innerHTML = '';
          updateSummary();
        })
        .catch(error => {
          alert('Terjadi kesalahan: ' + error.message);
        });
      });
    });
    
    // Fetch random images for the gallery
    document.addEventListener('DOMContentLoaded', function() {
      fetch('https://script.google.com/macros/s/AKfycbweRwKHsxyhAGD1h6aHa8R58UK1vaEWSSm7HgkXx8VrssfNZoM6GYXRmovW87KX97Yu/exec')
      .then(response => response.json())
      .then(data => {
        var container = document.getElementById('randomImages');
        data.forEach(function(image) {
          var img = document.createElement('img');
          img.src = image.url;
          img.alt = "Random Image";
          container.appendChild(img);
        });
      })
      .catch(error => console.error('Error fetching images:', error));
    });
    
    // Fallback copy function using document.execCommand
    function fallbackCopyText(text) {
      var textarea = document.createElement("textarea");
      textarea.value = text;
      textarea.style.position = "fixed";
      textarea.style.top = 0;
      textarea.style.left = 0;
      textarea.style.width = "2em";
      textarea.style.height = "2em";
      textarea.style.padding = 0;
      textarea.style.border = "none";
      textarea.style.outline = "none";
      textarea.style.boxShadow = "none";
      textarea.style.background = "transparent";
      
      document.body.appendChild(textarea);
      textarea.focus();
      textarea.select();
      
      try {
        var successful = document.execCommand('copy');
        if(successful) {
          alert("IBAN berhasil disalin (fallback)!");
        } else {
          alert("Gagal menyalin IBAN.");
        }
      } catch (err) {
        alert("Gagal menyalin IBAN: " + err);
      }
      
      document.body.removeChild(textarea);
    }
  </script>
</body>
</html>
